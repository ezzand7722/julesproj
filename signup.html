<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ - Ø®Ø¯Ù…ØªÙŠ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="auth.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ› ï¸</span>
                <span class="logo-text">Ø®Ø¯Ù…ØªÙŠ</span>
            </a>

            <!-- Signup Form -->
            <div id="signupForm" class="auth-form active">
                <h1>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h1>
                <p class="auth-subtitle">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø®Ø¯Ù…ØªÙŠ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</p>

                <div class="user-type-toggle">
                    <button type="button" class="type-btn active" onclick="setUserType('customer', event)">ğŸ‘¤
                        Ø¹Ù…ÙŠÙ„</button>
                    <button type="button" class="type-btn" onclick="setUserType('provider', event)">ğŸ› ï¸ Ù…Ù‚Ø¯Ù…
                        Ø®Ø¯Ù…Ø©</button>
                </div>

                <form onsubmit="handleSignup(event)">
                    <input type="hidden" id="userType" value="customer">

                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="signupName" required placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="signupEmail" required placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="signupPhone" required placeholder="07XXXXXXXX" pattern="07[0-9]{8}">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="password-wrapper">
                            <input type="password" id="signupPassword" required placeholder="8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                                minlength="8">
                            <button type="button" class="toggle-password"
                                onclick="togglePassword('signupPassword')">ğŸ‘ï¸</button>
                        </div>
                    </div>

                    <!-- Provider-specific fields -->
                    <div id="providerFields" class="provider-fields hidden">
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ®ØµØµ</label>
                            <select id="providerSpecialty">
                                <option value="">Ø§Ø®ØªØ± ØªØ®ØµØµÙƒ</option>
                                <option value="Ø³Ø¨Ø§ÙƒØ©">Ø³Ø¨Ø§ÙƒØ©</option>
                                <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                                <option value="ØªÙ†Ø¸ÙŠÙ">ØªÙ†Ø¸ÙŠÙ</option>
                                <option value="ØªÙƒÙŠÙŠÙ">ØªÙƒÙŠÙŠÙ ÙˆØªØ¨Ø±ÙŠØ¯</option>
                                <option value="Ø¯Ø±ÙˆØ³ Ø®ØµÙˆØµÙŠØ©">Ø¯Ø±ÙˆØ³ Ø®ØµÙˆØµÙŠØ©</option>
                                <option value="Ø¯Ù‡Ø§Ù†">Ø¯Ù‡Ø§Ù† ÙˆØ¯ÙŠÙƒÙˆØ±</option>
                                <option value="Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«">Ù†Ù‚Ù„ Ø£Ø«Ø§Ø«</option>
                                <option value="ØµÙŠØ§Ù†Ø© Ø¹Ø§Ù…Ø©">ØµÙŠØ§Ù†Ø© Ø¹Ø§Ù…Ø©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                            <select id="providerCity">
                                <option value="">Ø§Ø®ØªØ± Ù…Ø¯ÙŠÙ†ØªÙƒ</option>
                                <option value="Ø¹Ù…Ù‘Ø§Ù†">Ø¹Ù…Ù‘Ø§Ù†</option>
                                <option value="Ø¥Ø±Ø¨Ø¯">Ø¥Ø±Ø¨Ø¯</option>
                                <option value="Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡">Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡</option>
                                <option value="Ø§Ù„Ø¹Ù‚Ø¨Ø©">Ø§Ù„Ø¹Ù‚Ø¨Ø©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                            <input type="text" id="providerLocation" placeholder="Ù…Ø«Ø§Ù„: Ø®Ù„Ø¯Ø§ØŒ Ø§Ù„Ø¬Ø¨ÙŠÙ‡Ø©">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block" id="signupBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                </form>

                <p class="auth-switch">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </p>
            </div>

            <!-- Success Message -->
            <div id="successMessage" class="auth-form">
                <div class="success-icon">âœ…</div>
                <h1>ØªÙ… Ø¨Ù†Ø¬Ø§Ø­!</h1>
                <p class="auth-subtitle" id="successText">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.</p>
                <a href="login.html" class="btn btn-primary btn-block">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
            </div>
        </div>

        <div class="auth-decoration">
            <div class="decoration-shape"></div>
            <div class="decoration-text">
                <h2>Ù…Ù†ØµØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†</h2>
                <p>Ø£ÙƒØ«Ø± Ù…Ù† 5,000 Ù…Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø© Ù…ÙˆØ«ÙˆÙ‚</p>
            </div>
        </div>
    </div>

    <!-- Duplicate vital functions here to avoid any loading issues -->
    <script>
        const SUPABASE_URL = 'https://globdesovygfvvyuzrvy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdsb2JkZXNvdnlnZnZ2eXV6cnZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MDIwNDEsImV4cCI6MjA4NTI3ODA0MX0.wVdR293AFlCz2rYHWsindi8LKAaZIC4FXSYNKPD4UV0';

        let supabase;
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        } catch (e) { console.error('Supabase error:', e); }

        function togglePassword(id) {
            const x = document.getElementById(id);
            x.type = x.type === 'password' ? 'text' : 'password';
        }

        function setUserType(type, e) {
            document.getElementById('userType').value = type;
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
            if (e && e.target) e.target.classList.add('active');

            const fields = document.getElementById('providerFields');
            if (type === 'provider') fields.classList.remove('hidden');
            else fields.classList.add('hidden');
        }

        async function handleSignup(e) {
            e.preventDefault();
            const btn = document.getElementById('signupBtn');
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
            btn.disabled = true;

            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const name = document.getElementById('signupName').value;
            const phone = document.getElementById('signupPhone').value;
            const type = document.getElementById('userType').value;

            try {
                // 1. Create Auth User
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: { data: { name, phone, user_type: type } }
                });

                if (error) throw error;

                // 2. Add Provider Details (if provider)
                if (type === 'provider') {
                    const specialty = document.getElementById('providerSpecialty').value;
                    const city = document.getElementById('providerCity').value;
                    const location = document.getElementById('providerLocation').value;

                    if (!specialty || !city) throw new Error('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');

                    const { error: dbError } = await supabase
                        .from('providers')
                        .insert([{
                            user_id: data.user.id,
                            name: name,
                            phone: phone,
                            specialty: specialty,
                            city: city,
                            location: location,
                            rating: 5.0,
                            reviews: 0
                        }]);

                    if (dbError) throw dbError;
                }

                // Show Success
                document.getElementById('signupForm').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';

            } catch (err) {
                alert('Ø®Ø·Ø£: ' + err.message);
                btn.disabled = false;
                btn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
            }
        }
    </script>
</body>

</html>